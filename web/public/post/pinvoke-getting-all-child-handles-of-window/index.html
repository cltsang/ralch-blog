<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">


<meta name="keywords" content="">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="PINVOKE: Getting all child handles of window : "/>
<meta property="og:site_name" content="Svett Ralchev"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://localhost:1313/post/pinvoke-getting-all-child-handles-of-window/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-04-11"/>
<meta property="article:modified_time" content="2015-04-11"/>



  <title> PINVOKE: Getting all child handles of window &middot; Software adventures and thoughts </title>

  
  <link rel="stylesheet" href="http://localhost:1313//css/poole.css">
  <link rel="stylesheet" href="http://localhost:1313//css/syntax.css">
  <link rel="stylesheet" href="http://localhost:1313//css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300' rel='stylesheet' type='text/css'>

  
  <link href="" rel="alternate" type="application/rss+xml" title="Software adventures and thoughts" />

  
  <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 class="brand"><a href="http://localhost:1313/">Svett Ralchev</a></h1>
      <p class="lead">
       Software adventures and thoughts 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a></li>
      
        <li><a href="/about/">About </a></li>
      
    </ul>
      <a href="http://uk.linkedin.com/in/svettralchev"><i class="fa fa-linkedin-square"></i></a>&nbsp;&nbsp;
      <a href="http://www.ralch.com"><i class="fa fa-link"></i></a>&nbsp;&nbsp;
      <a href="https://twitter.com/ralch"><i class="fa fa-twitter-square"></i></a>&nbsp;&nbsp;
      
      <a href="https://github.com/svett"><i class="fa fa-github-square"></i></a>&nbsp;&nbsp;
      

    <p class="footnote">powered by <a href="http://hugo.spf13.com">Hugo</a> <br/>
      &copy; 2015 Svett Ralchev. All rights reserved.</p>
    
  </div>
</div>


  <div class="content container">
  <div class="post">
    <h1 class="post-title">PINVOKE: Getting all child handles of window</h1>
    <p>If you don’t know I have a new job in Bulgaria. I went away form Web Development and now I’m working as Windows Developer.
However, we had a client that exceed the number of window handles (more than 10 000) due to bad design of application.
While diagnosing his application, we needed to understand how many handles are created per window.</p>

<p>Windows API provide the availability to get all child handles for specified handle.
We should use <code>EnumChildWindows</code> function provided by <code>user32.dll</code>.</p>

<p><code>EnumChildWindows</code> function enumerates the child windows that belong to the specified parent window by passing the handle to each child window, in turn,
to an application-defined callback function. <code>EnumChildWindows</code> continues until the last child window is enumerated or the callback function returns FALSE.</p>

<pre><code>BOOL EnumChildWindows( 
         HWND hWndParent, 
         WNDENUMPROC lpEnumFunc, 
         LPARAM lParam 
);
</code></pre>

<ul>
<li><code>hWndParent</code> - [in] Handle to the parent window whose child windows are to be enumerated.</li>
<li><code>lpEnumFunc</code> - [in] Pointer to an application-defined callback function.</li>
<li><code>lParam</code> - [in] Specifies an application-defined value to be passed to the callback function.</li>
</ul>

<p>If a child window has created child windows of its own, <code>EnumChildWindows</code> enumerates those windows as well.</p>

<pre><code>public class WindowHandleInfo
{
    private delegate bool EnumWindowProc(IntPtr hwnd, IntPtr lParam);
 
    [DllImport(&quot;user32&quot;)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool EnumChildWindows(IntPtr window, EnumWindowProc callback, IntPtr lParam);
 
    private IntPtr _MainHandle;
 
    public WindowHandleInfo(IntPtr handle)
    {
        this._MainHandle = handle;
    }
 
    public List&lt;IntPtr&gt; GetAllChildHandles()
    {
        List&lt;IntPtr&gt; childHandles = new List&lt;IntPtr&gt;();
 
        GCHandle gcChildhandlesList = GCHandle.Alloc(childHandles);
        IntPtr pointerChildHandlesList = GCHandle.ToIntPtr(gcChildhandlesList);
 
        try
        {
            EnumWindowProc childProc = new EnumWindowProc(EnumWindow);
            EnumChildWindows(this._MainHandle, childProc, pointerChildHandlesList);
        }
        finally
        {
            gcChildhandlesList.Free();
        }
 
        return childHandles;
    }
 
    private bool EnumWindow(IntPtr hWnd, IntPtr lParam)
    {
        GCHandle gcChildhandlesList = GCHandle.FromIntPtr(lParam);
 
        if (gcChildhandlesList == null || gcChildhandlesList.Target == null)
        {
            return false;
        }
 
        List&lt;IntPtr&gt; childHandles = gcChildhandlesList.Target as List&lt;IntPtr&gt;;
        childHandles.Add(hWnd);
 
        return true;
    }
}
</code></pre>

    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost") 
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'ralch';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the comments powered by <a href="http://disqus.com/?ref_noscript">Disqus.</a></noscript>

  </div>
  </div>

  <script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
